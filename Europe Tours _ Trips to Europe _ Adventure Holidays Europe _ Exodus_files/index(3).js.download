(()=>{var e={3651:()=>{const{customElements:e,HTMLElement:t,CustomEvent:i}=window;e.define("ex-trip-search-form-button",class extends t{constructor(){super(),this.addEventListener("click",this.openSearchForm.bind(this)),this.openSearchFormEvent=new i("ex-form-hero-search-open",{bubbles:!1,detail:{source:this}})}openSearchForm(){this.classList.add("active"),this.ownerDocument.defaultView.dispatchEvent(this.openSearchFormEvent)}})}},t={};function i(a){var l=t[a];if(void 0!==l)return l.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,i),s.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";i(3651);function e(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function t(t){for(var i=1;i<arguments.length;i++){var l=null!=arguments[i]?arguments[i]:{};i%2?e(Object(l),!0).forEach((function(e){a(t,e,l[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(l)):e(Object(l)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(l,e))}))}return t}function a(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const{customElements:l,HTMLElement:s,localStorage:r}=window;l.define("ex-trip-search-form",class extends s{constructor(){var e;super(),this.tripSearchForm=this.querySelector("form.trip-search-form__form"),null===(e=this.tripSearchForm)||void 0===e||e.addEventListener("submit",this.handleFormSubmit.bind(this)),this.searchAutoComplete=this.querySelector(".search-autocomplete"),this.dateMultiSelectEl=this.querySelector(".trip-search-form__month-field .multi-select"),this.activityMultiSelectEl=this.querySelector(".trip-search-form__activity-field .multi-select"),this.resetDatesOnInitialRender=!1,this.localStorageKey="ex_data_trips_search_form",this.apiURL=this.getAttribute("filter-options-api-url"),this.activityOptions=this.activityMultiSelectEl?this.activityMultiSelectEl.getAttribute("options"):[],this.activityOptions=this.activityOptions?JSON.parse(this.activityOptions):[],this.datesOptions=this.dateMultiSelectEl?this.dateMultiSelectEl.getAttribute("options"):[],this.datesOptions=this.datesOptions?JSON.parse(this.datesOptions):[],this.initializeLocalStorageData()}connectedCallback(){setTimeout((()=>{var e,t;this.monthsInput=this.tripSearchForm.querySelector("div.trip-search-form__month-field .multi-select__input"),this.activityInput=this.tripSearchForm.querySelector("div.trip-search-form__activity-field .multi-select__input"),this.searchAutocompleteInput=this.querySelector("div.trip-search-form__search-autocomplete-field .search-autocomplete__input"),this.searchAutocompleteHiddenInput=this.querySelector("div.trip-search-form__search-autocomplete-field .search-autocomplete__hidden-value"),this.searchAutocompleteEl=this.querySelector("div.trip-search-form__search-autocomplete-field .search-autocomplete"),this.searchAutocompleteClearBtn=this.querySelector(".search-autocomplete__clear-btn"),this.dateRangeField=this.querySelector(".trip-search-form__date-range-field"),null===(e=this.monthsInput)||void 0===e||e.addEventListener("change",this.formatMonthData.bind(this)),null===(t=this.activityInput)||void 0===t||t.addEventListener("change",this.handleActivityInputSelection.bind(this)),this.searchAutocompleteEl.addEventListener("ex-search-autocomplete-updated",this.addSearchDataToLocalStorage.bind(this)),this.searchAutocompleteInput.addEventListener("keyup",this.addSearchDataToLocalStorageOnInputChange.bind(this)),this.searchAutocompleteClearBtn.addEventListener("click",this.handleSearchClearButtonClick.bind(this)),this.initializeFiltersDataFromLocalStorage()}),50)}handleActivityInputSelection(){var e,t,i,a,l,s,r,o;const c=this.addActivitiesDataToLocalStorage(),n=Array.isArray(c)&&null!=c&&c.length?c.map((e=>e.value)).filter((e=>e>0)):[];this.tripSearchFormData=this.getFromLocalStorage();const h="filter[destinations][]"===(null!==(e=null===(t=this.tripSearchFormData)||void 0===t||null===(t=t.searchQuery)||void 0===t?void 0:t.key)&&void 0!==e?e:"")?this.tripSearchFormData.searchQuery.value:0;let u=[],d=[];const v=null===(i=this.getFromLocalStorage())||void 0===i||null===(i=i.dates)||void 0===i?void 0:i.selectedChoices,p=null===(a=this.getFromLocalStorage())||void 0===a||null===(a=a.dates)||void 0===a?void 0:a.selectedDates,y=null===(l=this.getFromLocalStorage())||void 0===l||null===(l=l.dates)||void 0===l?void 0:l.previouslySelectedChoices,S=null===(s=this.getFromLocalStorage())||void 0===s||null===(s=s.dates)||void 0===s?void 0:s.previouslySelectedDates;var m,g;(u=(null==v?void 0:v.length)>0?null!=v?v:[]:null!=y?y:[],d=(null==p?void 0:p.length)>0?null!=p?p:[]:null!=S?S:[],this.setKeyValuePairToLocalStorage("dates",{selectedChoices:[],selectedDates:[],previouslySelectedChoices:null!==(r=u)&&void 0!==r?r:[],previouslySelectedDates:null!==(o=d)&&void 0!==o?o:[]}),this.resetDatesOnInitialRender)&&(this.setKeyValuePairToLocalStorage("dates",{selectedChoices:[],selectedDates:[],previouslySelectedChoices:null!==(m=u)&&void 0!==m?m:[],previouslySelectedDates:null!==(g=d)&&void 0!==g?g:[]}),this.dateRangeField&&(!d.length>0?this.dateRangeField.value="":this.updateDateValues(d)));this.resetDatesOnInitialRender=!0,this.fetchAndUpdateDates(h,n)}addActivitiesDataToLocalStorage(){var e,t;if(!this.activityMultiSelectEl.multiSelect)return[];let i=this.activityMultiSelectEl.multiSelect.getValue();return i=null!==(e=i)&&void 0!==e&&e.length?i.map((e=>{var t,i;return{label:null!==(t=null==e?void 0:e.label)&&void 0!==t?t:"",value:null!==(i=null==e?void 0:e.value)&&void 0!==i?i:""}})):[],this.setKeyValuePairToLocalStorage("activities",{selectedChoices:i,previouslySelectedChoices:null!==(t=i)&&void 0!==t?t:[]}),i}addSearchDataToLocalStorage(e){var t,i,a,l,s,r,o,c,n,h;const u=null!==(t=null==e?void 0:e.detail)&&void 0!==t?t:{},d=u.text;this.setKeyValuePairToLocalStorage("searchQuery",{type:null!==(i=null==u?void 0:u.type)&&void 0!==i?i:"",key:null!==(a=null==u?void 0:u.key)&&void 0!==a?a:"",value:"keywords"===u.type?u.value:u.id,text:d||u.label});const v=null===(l=this.getFromLocalStorage())||void 0===l||null===(l=l.activities)||void 0===l?void 0:l.selectedChoices;this.setKeyValuePairToLocalStorage("activities",{selectedChoices:[],previouslySelectedChoices:null!=v?v:[]});let p=[],y=[];const S=null===(s=this.getFromLocalStorage())||void 0===s||null===(s=s.dates)||void 0===s?void 0:s.selectedChoices,m=null===(r=this.getFromLocalStorage())||void 0===r||null===(r=r.dates)||void 0===r?void 0:r.selectedDates,g=null===(o=this.getFromLocalStorage())||void 0===o||null===(o=o.dates)||void 0===o?void 0:o.previouslySelectedChoices,f=null===(c=this.getFromLocalStorage())||void 0===c||null===(c=c.dates)||void 0===c?void 0:c.previouslySelectedDates;p=(null==S?void 0:S.length)>0?null!=S?S:[]:null!=g?g:[],y=(null==m?void 0:m.length)>0?null!=m?m:[]:null!=f?f:[],this.setKeyValuePairToLocalStorage("dates",{selectedChoices:[],selectedDates:[],previouslySelectedChoices:null!==(n=p)&&void 0!==n?n:[],previouslySelectedDates:null!==(h=y)&&void 0!==h?h:[]}),"keywords"!==u.type&&this.fetchAndUpdateActivitiesAndDates(u.id)}addSearchDataToLocalStorageOnInputChange(e){const t=e.target.parentElement.getAttribute("id")||"",i=e.target.value;this.setKeyValuePairToLocalStorage("searchQuery",{type:"keywords",key:"filter[q]",value:t||i,text:i})}handleSearchClearButtonClick(){this.setKeyValuePairToLocalStorage("searchQuery",{type:"",key:"",value:"",text:""}),this.activityOptions.length&&(this.setKeyValuePairToLocalStorage("activities",{selectedChoices:[]}),this.activityMultiSelectEl.setAttribute("placeholder","All activities"),this.setActivityOptionsAndChoices(this.activityOptions[0].choices)),this.datesOptions.length&&(this.setKeyValuePairToLocalStorage("dates",{selectedChoices:[],selectedDates:[]}),this.dateMultiSelectEl.setAttribute("placeholder","All months"),this.setDatesOptionsAndChoices(this.datesOptions))}initializeLocalStorageData(){this.tripSearchFormData=this.getFromLocalStorage(),this.tripSearchFormData||(this.tripSearchFormData={searchQuery:{type:"",key:"",value:"",text:""},activities:{selectedChoices:[]},dates:{selectedChoices:[],selectedDates:[]}}),this.setToLocalStorage(this.tripSearchFormData)}initializeFiltersDataFromLocalStorage(){var e,t,i,a,l,s,r,o,c,n,h,u;if(this.tripSearchFormData=this.getFromLocalStorage(),!this.tripSearchFormData)return null;Object.keys(this.tripSearchFormData.searchQuery).length&&(this.searchQuery=this.tripSearchFormData.searchQuery,this.searchAutocompleteEl.setAttribute("value",null!==(l=null===(s=this.searchQuery)||void 0===s?void 0:s.value)&&void 0!==l?l:""),this.searchAutocompleteEl.setAttribute("id",null!==(r=null===(o=this.searchQuery)||void 0===o?void 0:o.value)&&void 0!==r?r:""),this.searchAutocompleteHiddenInput.setAttribute("name",null!==(c=null===(n=this.searchQuery)||void 0===n?void 0:n.key)&&void 0!==c?c:""),this.searchAutocompleteInput.value=null!==(h=null===(u=this.searchQuery)||void 0===u?void 0:u.text)&&void 0!==h?h:"",this.searchQuery.value&&this.searchAutocompleteClearBtn.setAttribute("visible","true"));const d="filter[destinations][]"===(null===(e=this.searchQuery)||void 0===e?void 0:e.key)&&null!==(t=this.searchQuery)&&void 0!==t&&t.value?this.searchQuery.value:0,v=null!==(i=null===(a=this.tripSearchFormData)||void 0===a||null===(a=a.activities)||void 0===a?void 0:a.selectedChoices)&&void 0!==i?i:[],p=Array.isArray(v)?v.map((e=>e.value)).filter((e=>e>0)):[];var y;(this.fetchAndUpdateActivitiesAndDates(parseInt(d),p),this.tripSearchFormData.dates.selectedDates.length>0)?this.updateDateValues(this.tripSearchFormData.dates.selectedDates):this.updateDateValues(null===(y=this.tripSearchFormData.dates)||void 0===y?void 0:y.previouslySelectedDates)}formatMonthData(e){const t=e.target.value,i=e.target.textContent||"";if(!t)return this.updateDateValues([]),void this.setKeyValuePairToLocalStorage("dates",{selectedChoices:[],selectedDates:[],previouslySelectedChoices:[],previouslySelectedDates:[]});const[a,l]=t.split("-"),s=(new Date).getMonth()+1,r=(new Date).getFullYear(),o=new Date(l,a,0).getDate();let c="",n="";if(s===parseInt(a)&&parseInt(l)===r){const e=(new Date).getDate();return c="".concat(l,"-").concat(this.prependZero(a),"-").concat(this.prependZero(e)),n="".concat(l,"-").concat(this.prependZero(a),"-").concat(this.prependZero(o)),this.updateDateValues([c,n]),void this.setKeyValuePairToLocalStorage("dates",{selectedChoices:[{label:i,value:t}],selectedDates:[c,n]})}c="".concat(l,"-").concat(this.prependZero(a),"-01"),n="".concat(l,"-").concat(this.prependZero(a),"-").concat(this.prependZero(o)),this.updateDateValues([c,n]),this.setKeyValuePairToLocalStorage("dates",{selectedChoices:[{label:i,value:t}],selectedDates:[c,n]})}updateDateValues(e){const t=this.tripSearchForm.querySelector(".trip-search-form__date-range-field");if(!Array.isArray(e)||!e.length)return void t.setAttribute("value","");const[i,a]=e;t&&t.setAttribute("value","".concat(i,",").concat(a))}getFromLocalStorage(){return this.tripSearchFormData=r.getItem(this.localStorageKey),this.tripSearchFormData?JSON.parse(this.tripSearchFormData):""}setToLocalStorage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&r.setItem(this.localStorageKey,JSON.stringify(e))}setKeyValuePairToLocalStorage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.tripSearchFormData=this.getFromLocalStorage(),this.tripSearchFormData=t(t({},this.tripSearchFormData),{},{[e]:i}),this.setToLocalStorage(this.tripSearchFormData)}fetchAndUpdateActivitiesAndDates(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.apiURL&&this.activityMultiSelectEl.multiSelect&&this.dateMultiSelectEl.multiSelect&&(this.activityMultiSelectEl.setAttribute("loading","true"),this.dateMultiSelectEl.setAttribute("loading","true"),this.fetchURL="".concat(this.apiURL,"?destination_term_id=").concat(e||0),this.fetchURL=Array.isArray(t)&&t.length?"".concat(this.fetchURL,"&activity_term_ids=").concat(t.toString()):this.fetchURL,fetch(this.fetchURL).then((e=>e.json())).then((e=>{this.setActivityOptionsAndChoices(e.activities),this.setDatesOptionsAndChoices(Array.isArray(e.months)?e.months:[]),this.dateMultiSelectEl.setAttribute("loading","false"),this.activityMultiSelectEl.setAttribute("loading","false"),this.handleActivityInputSelection()})))}fetchAndUpdateDates(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.apiURL&&this.dateMultiSelectEl.multiSelect&&(e||Array.isArray(t)||t.length)&&(this.dateMultiSelectEl.setAttribute("loading","true"),this.fetchURL="".concat(this.apiURL,"?destination_term_id=").concat(e||0,"&activity_term_ids=").concat(t.toString()||""),fetch(this.fetchURL).then((e=>e.json())).then((e=>{this.setDatesOptionsAndChoices(Array.isArray(e.months)?e.months:[]),this.dateMultiSelectEl.setAttribute("loading","false")})))}setDatesOptionsAndChoices(){var e,i,a,l;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(s)||!s.length)return;let r=null!==(e=null===(i=this.tripSearchFormData)||void 0===i||null===(i=i.dates)||void 0===i?void 0:i.selectedChoices)&&void 0!==e?e:[],o=null!==(a=null===(l=this.tripSearchFormData)||void 0===l||null===(l=l.dates)||void 0===l?void 0:l.previouslySelectedChoices)&&void 0!==a?a:[];r=r.map((e=>e.value)),o=o.map((e=>e.value)),s=this.updateSelectedItemsInOptions(s,r,o);s.find((e=>e.selected))||this.updateDateValues([]);const c=this.datesOptions,n=s.map((e=>null==e?void 0:e.value));c.forEach((e=>{n.includes(null==e?void 0:e.value)||s.push(t(t({},e),{},{disabled:!0}))})),this.dateMultiSelectEl&&this.dateMultiSelectEl.setAttribute("options",JSON.stringify(s))}setActivityOptionsAndChoices(){var e,i,a,l;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(s))return;let r=null!==(e=null===(i=this.tripSearchFormData)||void 0===i||null===(i=i.activities)||void 0===i?void 0:i.selectedChoices)&&void 0!==e?e:[],o=null!==(a=null===(l=this.tripSearchFormData)||void 0===l||null===(l=l.activities)||void 0===l?void 0:l.previouslySelectedChoices)&&void 0!==a?a:[];r=r.map((e=>e.value)),o=o.map((e=>e.value));const c=this.updateSelectedItemsInOptions(s,r,o),n=this.activityOptions[0].choices,h=c.map((e=>e.value));n.forEach((e=>{h.includes(null==e?void 0:e.value)||c.push(t(t({},e),{},{disabled:!0}))})),s=c,this.activityMultiSelectEl&&this.activityMultiSelectEl.setAttribute("options",JSON.stringify(s))}updateSelectedItemsInOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Array.isArray(e)&&Array.isArray(t)?1===e.length?(e[0].selected=!0,e):(e.forEach(((i,a)=>{e[a].selected=t.includes(i.value)})),e.forEach(((t,a)=>{e[a].selected=i.includes(t.value)})),e):[]}handleFormSubmit(e){e.preventDefault();const i=[...new window.FormData(e.target).entries()],a=this.tripSearchForm.getAttribute("action"),l=new URL(a);let s={};i.forEach((e=>{const i=e[0],a=e[1],l=this.getParamsForPageUrl(i,a);if(!l.key||!l.value)return;const r=s[l.key]?[...s[l.key],l.value]:[l.value];s=t(t({},s),{},{[l.key]:"activities"===l.key?r:l.value})})),Object.keys(s).forEach((e=>{const t=s[e];t&&l.searchParams.append(e,t)})),window.location.href=l.toString()}getParamsForPageUrl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!e||!t||!this.searchAutoComplete)return{};const i={};switch(e){case"filter[q]":i.key="q",i.value=t;break;case"filter[destinations][]":i.key="destinations",i.value=this.searchAutoComplete.getAttribute("id");break;case"filter[activities][]":i.key="activities",i.value=t;break;case"filter[date_range]":i.key="date_range",i.value=t;break;default:i.key=e,i.value=t}return i}prependZero(e){return isNaN(e)?e:+e<10?"0"+e:e}})})()})();